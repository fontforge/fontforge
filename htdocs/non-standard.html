<HTML>
<HEAD>
  <!-- Created with AOLpress/2.0 -->
  <!-- AP: Created on: 30-Jun-2003 -->
  <!-- AP: Last modified: 13-Aug-2007 -->
  <TITLE>Non standard extensions used by FontForge in True/Open Type</TITLE>
  <LINK REL="icon" href="ffanvil16.png">
  <LINK REL="stylesheet" TYPE="text/css" HREF="FontForge.css">
</HEAD>
<BODY>
<DIV id="in">
  <H1 ALIGN=Center>
    Non standard extensions used FontForge in True/Open Type
  </H1>
  <H2>
    Non standard feature tags
  </H2>
  <P>
  Internal
  <UL>
    <LI>
      <CODE>' REQ'</CODE> -- tag used for required features
  </UL>
  <P>
  For TeX<BR>
  I no longer use these. MS has come up with a MATH table which can contain
  all the TeX information.
  <UL>
    <LI>
      <CODE>ITLC</CODE> -- <A HREF="PfaEdit-TeX.html#Italic">Italic
      correction</A><BR>
      I have proposed this as an extension to OpenType. There was some discussion
      of it, but I believe the idea died.
    <LI>
      <CODE>TCHL</CODE> -- <A HREF="PfaEdit-TeX.html#charlist">TeX Charlist</A>
    <LI>
      <CODE>TEXL</CODE> -- <A HREF="PfaEdit-TeX.html#extension">TeX Extension
      List</A>
  </UL>
  <H2>
    Non standard tables.
  </H2>
  <UL>
    <LI>
      <A HREF="non-standard.html#PfEd">'PfEd' the FontForge extensions table</A>
    <LI>
      <A HREF="#TeX">'TeX ' the TeX metrics table</A>
    <LI>
      <A HREF="#BDF">'BDF ' the BDF properties table</A>
    <LI>
      <A HREF="#FFTM">'FFTM' the FontForge time stamp table</A> 
	<HR>
    <LI>
      (<A HREF="TrueOpenTables.html">standard tables</A>)
  </UL>
  <P>
  Non standard file formats
  <UL>
    <LI>
      <A HREF="bitmaponlysfnt.html#MS">Bitmap only sfnt for MS Windows</A>
  </UL>
  <H2>
    '<A NAME="PfEd">PfEd</A>' -- the FontForge extensions table
  </H2>
  <P>
  (the name is 'PfEd' for historical reasons)
  <BLOCKQUOTE>
    The table begins with a table header containing a version number and a count
    of sub-tables
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>version</TD>
	<TD>currently 0x00010000</TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>count</TD>
	<TD></TD>
      </TR>
    </TABLE>
    <P>
    This is followed by a table of contents, there will be count replications
    of the following structure (ie. a tag and offset for each sub-table
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>tag</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>offset</TD>
	<TD>from start of 'PfEd' table</TD>
      </TR>
    </TABLE>
    <P>
    The format of the subtable depends on the sub-table's tag. There are currently
    3 tags supported, these are
    <UL>
      <LI>
	'<A HREF="#colr">colr</A>' -- per glyph color sub-table (stores the color
	that appears in the font view)
      <LI>
	'<A HREF="non-standard.html#cmnt">cmnt</A>' -- per glyph comment sub-table
	(stores the comment that appears in the Char Info dialog for the character)
      <LI>
	'<A HREF="non-standard.html#fcmt">fcmt</A>' -- the font comment sub-table
	(stores the comment that appears in the Font Info dialog)
    </UL>
  </BLOCKQUOTE>
  <H3>
    '<A NAME="colr">colr</A>' -- the per-glyph color sub-table
  </H3>
  <BLOCKQUOTE>
    The sub-table header begins with a version number, and a count of ranges
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>0</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>count</TD>
	<TD>of ranges</TD>
      </TR>
    </TABLE>
    <P>
    After this will be &lt;count&gt; instances of the following structure
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>starting glyph index</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>ending glyph index</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>color</TD>
	<TD>expressed as a 24bit rgb value</TD>
      </TR>
    </TABLE>
  </BLOCKQUOTE>
  <H3>
    '<A NAME="cmnt">cmnt</A>' -- the per-glyph comment sub-table
  </H3>
  <BLOCKQUOTE>
    The sub-table header begins with a version number, and a count of ranges
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>0</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>count</TD>
	<TD>of ranges</TD>
      </TR>
    </TABLE>
    <P>
    After this will be &lt;count&gt; instances of the following structure
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>starting glyph index</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>ending glyph index</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>offset</TD>
	<TD>from the start of this sub-table</TD>
      </TR>
    </TABLE>
    <P>
    The offset points to an array of offsets
    (&lt;end&gt;-&lt;start&gt;+1+1) elements in the array, so one element for
    each glyph index mentioned in the range structure above, with one left over
    which allows readers to compute the the length of the last string.
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>offset</TD>
	<TD>from start of table</TD>
      </TR>
      <TR>
	<TD></TD>
	<TD>...</TD>
	<TD></TD>
      </TR>
    </TABLE>
    <P>
    And each of these offsets points to a unicode (UCS2) string. The strings
    are assumed to be consecutive, so the length of each may be calculated by
    subtracting its offset from the offset to the next string.
  </BLOCKQUOTE>
  <H3>
    '<A NAME="fcmt">fcmt</A>' -- the font comment sub-table
  </H3>
  <BLOCKQUOTE>
    The sub-table header begins with a version number, and a count of ranges
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>0</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>length</TD>
	<TD>number of characters in the string</TD>
      </TR>
    </TABLE>
    <P>
    And this is followed by &lt;length&gt; Unicode (UCS2) characters. Currently
    these unicode characters will always contain ASCII values, but that may change
    some day.
  </BLOCKQUOTE>
  <H2>
    '<A NAME="TeX">TeX </A>' -- the TeX metrics table
  </H2>
  <BLOCKQUOTE>
    The table begins with a table header containing a version number and a count
    of sub-tables
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>version</TD>
	<TD>currently 0x00010000</TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>count</TD>
	<TD></TD>
      </TR>
    </TABLE>
    <P>
    This is followed by a table of contents, there will be count replications
    of the following structure (ie. a tag and offset for each sub-table
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>tag</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>offset</TD>
	<TD>from start of 'PfEd' table</TD>
      </TR>
    </TABLE>
    <P>
    The format of the subtable depends on the sub-table's tag. There are currently
    3 tags supported, these are
    <UL>
      <LI>
	'<A HREF="#ftpm">ftpm</A>' -- the font parameter table
      <LI>
	'<A HREF="#htdp">htdp</A>' -- per glyph height/depth sub-table (stores TeX's
	idea of the height and depth of glyphs (should correct for optical overshoot))
      <LI>
	'<A HREF="#sbsp">sbsp</A>' -- per glyph sub/super-script sub-table
    </UL>
  </BLOCKQUOTE>
  <H3>
    '<A NAME="htdp">htdp</A>' -- the per-glyph color sub-table
  </H3>
  <BLOCKQUOTE>
    The sub-table header begins with a version number, and a count of glyphs
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>0</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>count</TD>
	<TD>of glyphs</TD>
      </TR>
    </TABLE>
    <P>
    After this will be &lt;count&gt; instances of the following structure
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>height</TD>
	<TD>in em-units</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>depth</TD>
	<TD></TD>
      </TR>
    </TABLE>
  </BLOCKQUOTE>
  <P>
  I store these values in em-units rather than in the fix_word of a tfm file
  because em-units make more sense in a sfnt and take up less space.
  <H3>
    '<A NAME="sbsp">sbsp</A>' -- the per-glyph sub/super-script sub-table
  </H3>
  <BLOCKQUOTE>
    This sub-table has essentially the same format as the previous one. The sub-table
    header begins with a version number, and a count of glyphs
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>0</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>count</TD>
	<TD>of glyphs</TD>
      </TR>
    </TABLE>
    <P>
    After this will be &lt;count&gt; instances of the following structure
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>subscript offset</TD>
	<TD>in em-units</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>superscript offset</TD>
	<TD></TD>
      </TR>
    </TABLE>
  </BLOCKQUOTE>
  <P>
  I store these values in em-units rather than in the fix_word of a tfm file
  because em-units make more sense in a sfnt and take up less space.
  <H3>
    '<A NAME="ftpm">ftpm</A>' -- the font parameter (font dimensions) sub-table
  </H3>
  <BLOCKQUOTE>
    The sub-table header begins with a version number, and a count of parameters
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>0</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>count</TD>
	<TD>number of parameters in the font</TD>
      </TR>
    </TABLE>
    <P>
    And this is followed by &lt;count&gt; instances of the following structure:
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>tag</TD>
	<TD>parameter name</TD>
      </TR>
      <TR>
	<TD>int32</TD>
	<TD>value</TD>
	<TD></TD>
      </TR>
    </TABLE>
    <P>
    I store these values as fix_words and <EM>not</EM> as em-units because their
    meaning is not constrained by the spec and the <CODE>Slant</CODE> parameter
    (at the least) can not be converted to em-units.
    <P>
    I have defined the following 4-letter parameter tags
    <TABLE BORDER CELLPADDING="2">
      <TR>
	<TH>Tag</TH>
	<TH>Meaning</TH>
	<TH>traditional font parameter number in tfm file (font dimension number)</TH>
      </TR>
      <TR>
	<TD>Slnt</TD>
	<TD>Slant</TD>
	<TD>1</TD>
      </TR>
      <TR>
	<TD>Spac</TD>
	<TD>Space</TD>
	<TD>2</TD>
      </TR>
      <TR>
	<TD>Stre</TD>
	<TD>Stretch</TD>
	<TD>3</TD>
      </TR>
      <TR>
	<TD>Shnk</TD>
	<TD>Shrink</TD>
	<TD>4</TD>
      </TR>
      <TR>
	<TD>XHgt</TD>
	<TD>XHeight</TD>
	<TD>5</TD>
      </TR>
      <TR>
	<TD>Quad</TD>
	<TD>Quad</TD>
	<TD>6</TD>
      </TR>
      <TR>
	<TD>ExSp</TD>
	<TD>Extra Space</TD>
	<TD>7 (in text fonts)</TD>
      </TR>
      <TR>
	<TD>MtSp</TD>
	<TD>Math Space</TD>
	<TD>7 (in math and math extension fonts)</TD>
      </TR>
      <TR>
	<TD>Num1</TD>
	<TD>Num1</TD>
	<TD>8 (in math fonts)</TD>
      </TR>
      <TR>
	<TD>Num2</TD>
	<TD>Num2</TD>
	<TD>9</TD>
      </TR>
      <TR>
	<TD>Num3</TD>
	<TD>Num2</TD>
	<TD>10</TD>
      </TR>
      <TR>
	<TD>Dnm1</TD>
	<TD>Denom1</TD>
	<TD>11</TD>
      </TR>
      <TR>
	<TD>Dnm2</TD>
	<TD>Denom2</TD>
	<TD>12</TD>
      </TR>
      <TR>
	<TD>Sup1</TD>
	<TD>Sup1</TD>
	<TD>13</TD>
      </TR>
      <TR>
	<TD>Sup2</TD>
	<TD>Sup2</TD>
	<TD>14</TD>
      </TR>
      <TR>
	<TD>Sup3</TD>
	<TD>Sup3</TD>
	<TD>15</TD>
      </TR>
      <TR>
	<TD>Sub1</TD>
	<TD>Sub1</TD>
	<TD>16</TD>
      </TR>
      <TR>
	<TD>Sub2</TD>
	<TD>Sub2</TD>
	<TD>17</TD>
      </TR>
      <TR>
	<TD>SpDp</TD>
	<TD>Sup Drop</TD>
	<TD>18</TD>
      </TR>
      <TR>
	<TD>SbDp</TD>
	<TD>Sub Drop</TD>
	<TD>19</TD>
      </TR>
      <TR>
	<TD>Dlm1</TD>
	<TD>Delim 1</TD>
	<TD>20</TD>
      </TR>
      <TR>
	<TD>Dlm2</TD>
	<TD>Delim 2</TD>
	<TD>21</TD>
      </TR>
      <TR>
	<TD>AxHt</TD>
	<TD>Axis height</TD>
	<TD>22</TD>
      </TR>
      <TR>
	<TD>RlTk</TD>
	<TD>Default Rule Thickness</TD>
	<TD>8 (in math extension fonts)</TD>
      </TR>
      <TR>
	<TD>BOS1</TD>
	<TD>Big Op Spacing1</TD>
	<TD>9</TD>
      </TR>
      <TR>
	<TD>BOS2</TD>
	<TD>Big Op Spacing2</TD>
	<TD>10</TD>
      </TR>
      <TR>
	<TD>BOS3</TD>
	<TD>Big Op Spacing3</TD>
	<TD>11</TD>
      </TR>
      <TR>
	<TD>BOS4</TD>
	<TD>Big Op Spacing4</TD>
	<TD>12</TD>
      </TR>
      <TR>
	<TD>BOS5</TD>
	<TD>Big Op Spacing5</TD>
	<TD>13</TD>
      </TR>
    </TABLE>
    <P>
  </BLOCKQUOTE>
  <H2>
    '<A NAME="BDF">BDF </A>' -- the BDF properties table
  </H2>
  <BLOCKQUOTE>
    The table begins with a table header containing a version number and a count
    of strikes
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>version</TD>
	<TD>currently 0x0001</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>strike-count</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>offset to string table</TD>
	<TD>(from start of BDF table)</TD>
      </TR>
    </TABLE>
    <P>
    This is followed by an entry for each strike identifying how many properties
    that strike has.
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint16</TD>
	<TD>ppem</TD>
	<TD></TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>property-count</TD>
	<TD></TD>
      </TR>
    </TABLE>
    <P>
    Then there will be the properties, first there with be property-count[1]
    properties from the first strike, then property-count[2] properties for the
    second, etc. Each property looks like:
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>name</TD>
	<TD>offset into the string table of the property's name</TD>
      </TR>
      <TR>
	<TD>uint16</TD>
	<TD>type</TD>
	<TD>0=&gt;string<BR>
	  1=&gt;atom<BR>
	  2=&gt;int<BR>
	  3=&gt;uint<BR>
	  0x10 may be ored into one of the above types to indicate a real property</TD>
      </TR>
      <TR>
	<TD>uint32</TD>
	<TD>value</TD>
	<TD>For strings and atoms, this is an offset into the string table<BR>
	  for integers it is the value itself</TD>
      </TR>
    </TABLE>
    <P>
    The string table is a series of ASCII bytes. Each string is NUL terminated.
  </BLOCKQUOTE>
  <H2>
    '<A NAME="FFTM">FFTM</A>' the FontForge time stamp table
  </H2>
  <BLOCKQUOTE>
    The table begins with a table header containing a version number and is followed
    by a series of timestamps (same format as the timestamps in the head table
    -- 64 bit times, seconds since 00:00:00, 1-Jan-1904).
    <P>
    I don't think this is a duplication of the information in the 'head' table.
    Neither the Apple nor OpenType spec is clear: Does head.creationtime refer
    to the creation time of the truetype/opentype file, or of the font itself.
    After examining various fonts of Apple's, it appears that the 'head' entries
    contain the dates for the font file and not the font. The times in this table
    are specifically the creation time of the font (the sfd file), while the
    times in the 'head' table contain the creation time of the truetype or opentype
    font file.
    <TABLE CELLPADDING="2" BGCOLOR="#8080ff">
      <TR>
	<TD>uint32</TD>
	<TD>version</TD>
	<TD>currently 0x00000001</TD>
      </TR>
      <TR>
	<TD>int64</TD>
	<TD>FontForge's own timestamp</TD>
	<TD>(the date of the sources for fontforge)</TD>
      </TR>
      <TR>
	<TD>int64</TD>
	<TD>creation date of this font</TD>
	<TD>Not the creation date of the tt/ot file,<BR>
	  but the date the sfd file was created.<BR>
	  (not always accurate).</TD>
      </TR>
      <TR>
	<TD>int64</TD>
	<TD>last modification date of this font</TD>
	<TD>Not the modification date of the file,<BR>
	  but the time a glyph, etc. was last<BR>
	  changed in the font database.<BR>
	  (not always accurate)</TD>
      </TR>
    </TABLE>
    <P>
  </BLOCKQUOTE>
</DIV>
</BODY></HTML>
